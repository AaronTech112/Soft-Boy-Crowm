<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Soft Boy Crown — Product • Threads of Nigeria</title>
  <meta name="description" content="Product page for Threads of Nigeria jersey — Soft Boy Crown" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800;900&family=Bebas+Neue&family=Gloock&family=Great+Vibes&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
  <style>
    :root {
      --bg: #0b0b0b;
      --card: #121212;
      --ink: #ffffff;
      --dim: #9ca3af;
      --accent: #18ff8b;
      --accent-2: #ff3b3b;
      --brand: #d1ffec;
      --glass: rgba(255,255,255,.06);
      --radius: 1rem;
    }
    html, body {
      background: var(--bg);
      color: var(--ink);
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    a {
      color: inherit;
      text-decoration: none;
    }
    /* ====== NAV ====== */
    .nav-blur {
      backdrop-filter: saturate(180%) blur(10px);
      background: linear-gradient(180deg, rgba(0,0,0,.75), rgba(0,0,0,.35));
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .navbar-brand {
      font-family: "Bebas Neue", system-ui;
      letter-spacing: .08em;
      font-size: 1.85rem;
    }
    .brand-script {
      font-family: "Great Vibes", cursive;
      font-size: 1.2rem;
      color: var(--brand);
    }
    .nav-cta {
      border: 1px solid var(--accent);
      color: #0b0b0b;
      background: linear-gradient(135deg, var(--accent), #9bffca);
      border-radius: 999px;
      padding: .55rem 1rem;
      font-weight: 700;
    }
    .nav-cta:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 24px -10px var(--accent);
    }
    .cart-icon {
      position: relative;
      display: inline-flex;
      align-items: center;
      color: var(--ink);
    }
    .cart-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--accent);
      color: #0b0b0b;
      font-size: 0.7rem;
      font-weight: 700;
      min-width: 18px;
      height: 18px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    /* Product layout */
    .product-wrap {
      padding: clamp(2rem, 5vw, 4rem) 0;
    }
    .gallery {
      border-radius: var(--radius);
      overflow: hidden;
      border: 1px solid var(--glass);
      background: var(--card);
    }
    .main-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .thumbs {
      gap: .6rem;
    }
    .thumbs img {
      height: 72px;
      width: 72px;
      object-fit: cover;
      border-radius: .5rem;
      border: 2px solid transparent;
      cursor: pointer;
      transition: transform .2s;
    }
    .thumbs img:hover {
      transform: translateY(-2px);
    }
    .thumbs img.active {
      border-color: var(--accent);
    }
    .meta h1 {
      font-family: 'Gloock', serif;
      font-size: clamp(1.6rem, 3.6vw, 2.4rem);
      margin-bottom: .25rem;
    }
    .meta .sku {
      color: var(--dim);
      font-size: .85rem;
    }
    .meta .price {
      font-weight: 900;
      font-size: 1.5rem;
    }
    .meta .muted {
      color: var(--dim);
    }
    .swatch {
      width: 34px;
      height: 34px;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: 2px solid var(--glass);
      cursor: pointer;
      transition: all .2s;
    }
    .swatch.selected {
      outline: 3px solid rgba(24,255,139,.15);
      transform: translateY(-3px);
    }
    .swatch:hover {
      transform: translateY(-2px);
    }
    .size-btn {
      border-radius: .5rem;
      padding: .5rem .9rem;
      border: 1px solid var(--glass);
      background: transparent;
      color: var(--ink);
      transition: all .2s;
    }
    .size-btn:hover {
      background: var(--glass);
    }
    .size-btn.selected {
      background: var(--accent);
      color: #030303;
      font-weight: 700;
    }
    .qty {
      width: 110px;
    }
    .qty input {
      color: var(--ink);
      background: var(--card);
      border: 1px solid var(--glass);
      text-align: center;
    }
    .add-cart {
      background: var(--accent);
      color: #030303;
      border-radius: 999px;
      padding: .8rem 1.2rem;
      font-weight: 800;
      border: none;
      transition: transform .2s;
    }
    .add-cart:hover {
      transform: translateY(-2px);
    }
    .btn-ghost {
      color: var(--dim);
      border: 1px solid var(--glass);
      padding: .5rem 1rem;
      border-radius: .5rem;
    }
    .btn-ghost:hover {
      color: var(--ink);
      background: var(--glass);
    }
    .btn-outline-light {
      border-color: var(--glass);
      color: var(--ink);
    }
    .btn-outline-light:hover {
      background: var(--glass);
      color: var(--ink);
    }
    .tabs {
      border-top: 1px solid var(--glass);
      margin-top: 2rem;
      padding-top: 2rem;
    }
    .tabs .nav-link {
      color: var(--dim);
      border: none;
      padding: .75rem 1rem;
    }
    .tabs .nav-link.active {
      color: var(--ink);
      font-weight: 700;
      background: transparent;
      border-bottom: 2px solid var(--accent);
    }
    .policy {
      font-size: .9rem;
      color: var(--dim);
    }
    .related .product-card {
      background: transparent;
      border: 1px solid rgba(255,255,255,.04);
      transition: transform .2s;
    }
    .related .product-card:hover {
      transform: translateY(-4px);
    }
    .eyebrow {
      font-size: .9rem;
      font-weight: 600;
      color: var(--dim);
      text-transform: uppercase;
    }
    footer a:hover {
      color: var(--accent);
    }
    /* Responsive tweaks */
    @media (min-width: 992px) {
      .gallery { height: 560px; }
    }
    @media (max-width: 991px) {
      .thumbs img { height: 56px; width: 56px; }
      main { padding-top: 120px; }
    }
    @media (max-width: 576px) {
      main { padding-top: 100px; }
      .product-wrap { padding-top: 1rem; }
      .meta h1 { font-size: clamp(1.4rem, 3vw, 1.8rem); }
      .meta .price { font-size: 1.2rem; }
    }
  </style>
</head>
<body>
  <!-- ====== NAVBAR ====== -->
  <nav class="navbar navbar-expand-lg fixed-top nav-blur">
    <div class="container py-2">
      <a class="navbar-brand d-flex align-items-center gap-2" href="{% url 'home' %}">
        <span class="fs-3">SB</span>
        <span class="brand-script">Crown</span>
      </a>
      <button class="navbar-toggler text-white" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon d-inline-flex align-items-center justify-content-center" style="filter: invert(1)"><i class="bi bi-list fs-1"></i></span>
      </button>
      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto align-items-lg-center gap-lg-4">
          <li class="nav-item"><a class="nav-link text-white-50" href="{% url 'shop' %}">Shop</a></li>
          <li class="nav-item"><a class="nav-link text-white-50" href="{% url 'lookbook' %}">Lookbook</a></li>
          <li class="nav-item"><a class="nav-link text-white-50" href="{% url 'our_story' %}">About</a></li>
          <li class="nav-item"><a class="nav-link text-white-50" href="{% url 'contact' %}">Contact</a></li>
          <li class="nav-item"><a class="nav-link cart-icon" href="{% url 'cart' %}"><i class="bi bi-cart3 fs-5"></i><span class="cart-count">0</span></a></li>
          <li class="nav-item"><a class="nav-link text-white" href="{% url 'profile' %}"><i class="bi bi-person-circle fs-5"></i></a></li>
          <li class="nav-item ms-lg-2"><a class="btn nav-cta" href="{% url 'shop' %}">Shop Now</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <style>
    /* Toast Notification */
    .toast {
      background: var(--card);
      border: 1px solid var(--glass);
      color: var(--ink);
      border-radius: var(--radius);
    }
    .toast-success {
      border-left: 4px solid var(--accent);
    }
    .toast-error {
      border-left: 4px solid var(--accent-2);
    }
    .toast .btn-close {
      filter: invert(1);
    }
  </style>
  <!-- Toast Notification Container -->
  <div id="toastContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 1050;"></div>

  <style>
    .alert {
      background: var(--card);
      color: var(--ink);
      border: 1px solid var(--glass);
    }
    .alert-success {
      border-left: 4px solid var(--accent);
    }
    .alert-danger {
      border-left: 4px solid var(--accent-2);
    }
  </style>

    {% if messages %}
    <div class="container mt-3">
      {% for message in messages %}
        <div class="alert alert-{% if message.tags == 'success' %}success{% else %}danger{% endif %} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
    {% endif %}

  <main class="container product-wrap">
    <div class="row g-5">
      <!-- Gallery -->
      <div class="col-lg-6" style="padding-left: 10px;">
        <div class="gallery p-3" data-aos="fade-right">
          <div class="position-relative" style="height: 420px;">
            {% if product.images.all %}
              <img id="mainImage" src="{{ product.images.first.image.url }}" class="main-img rounded" alt="{{ product.name }}" />
            {% else %}
              <img id="mainImage" src="" class="main-img rounded" alt="{{ product.name }} - No image available" />
            {% endif %}
            <div class="position-absolute" style="right: 12px; bottom: 12px">
              <span class="badge bg-dark text-white">{% if product.in_stock > 0 %}In Stock: {{ product.in_stock }}{% else %}Out of Stock{% endif %}</span>
            </div>
          </div>
          <div class="d-flex align-items-center mt-3 thumbs" id="thumbList">
            {% for image in product.images.all %}
              <img src="{{ image.image.url }}" data-full="{{ image.image.url }}" class="{% if forloop.first %}active{% endif %} rounded" alt="{{ product.name }} - image {{ forloop.counter }}">
            {% endfor %}
          </div>
        </div>
        <div class="mt-4 d-flex gap-3">
          <a class="btn btn-ghost" href="{% url 'lookbook' %}">View in lookbook</a>
          <a class="btn btn-outline-light" href="{% url 'shop' %}">Back to shop</a>
        </div>
      </div>

      <!-- Meta -->
      <div class="col-lg-6" data-aos="fade-left">
        <div class="meta">
          <div class="d-flex align-items-start justify-content-between">
            <div>
              <h1>{{ product.name }}</h1>
              <div class="sku">SKU: SBC-{{ product.id }}</div>
            </div>
            <div class="text-end">
              <div class="price">₦{{ product.price }}</div>
              {% if product.slash_price %}
                <div class="muted"><s>₦{{ product.slash_price }}</s></div>
              {% else %}
                <div class="muted">Inclusive of VAT</div>
              {% endif %}
            </div>
          </div>
          <div class="mt-3 text-white-50">{{ product.description|safe }}</div>
          <form id="addToCartForm" action="{% url 'add_to_cart' product.id %}" method="POST">
            {% csrf_token %}
            {% if available_colors %}
            <div class="mb-2"><small class="muted">Color</small></div>
            <div class="d-flex gap-2 mb-3" id="colorSwatches">
              {% for color in available_colors %}
                <div class="swatch {% if forloop.first %}selected{% endif %}" data-color="{{ color.name }}" title="{{ color.name }}" style="background: {{ color.hex_code|default:'#000000' }}"></div>
              {% endfor %}
            </div>
            {% endif %}
            {% if available_sizes %}
            <div class="mb-2"><small class="muted">Size</small></div>
            <div class="d-flex gap-2 mb-3 flex-wrap">
              {% for size in available_sizes %}
                <button type="button" class="size-btn {% if forloop.first %}selected{% endif %}" data-size="{{ size.name }}">{{ size.name }}</button>
              {% endfor %}
            </div>
            {% endif %}
            <div class="d-flex align-items-center gap-3 mb-3">
              <div class="input-group qty">
    
                <input type="number" id="qty" name="quantity" class="form-control" value="1" min="1" aria-label="Quantity">
=
              </div>
              <input type="hidden" name="size" id="selected-size" value="{{ available_sizes.first.name|default:'' }}">
              <input type="hidden" name="color" id="selected-color" value="{{ available_colors.first.name|default:'' }}">
              <button type="submit" id="addToCart" class="add-cart" {% if product.in_stock <= 0 %}disabled{% endif %} aria-label="Add to cart">
                {% if product.in_stock > 0 %}Add to cart <i class="bi bi-bag-fill ms-2"></i>{% else %}Out of Stock{% endif %}
              </button>
            </div>
          </form>
          <div class="policy small text-white-50">
            <div>Ships within 2–4 business days • Free returns within 7 days</div>
          </div>
          <div class="mt-4">
            <a class="btn btn-outline-light" href="{% url 'shop' %}?category={{ product.category.id }}">View similar</a>
          </div>
        </div>
          <div class="mt-5 tabs">
          <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#desc" aria-selected="true">Description</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#ship" aria-selected="false">Shipping & Returns</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#rev" aria-selected="false">Reviews</button></li>
          </ul>
          <div class="tab-content p-3 bg-transparent border-0">
            <div class="tab-pane fade show active" id="desc" role="tabpanel">
              <div class="text-white-50">{{ product.description|safe }}</div>
            </div>
            <div class="tab-pane fade" id="ship" role="tabpanel">
              <p class="text-white-50">We ship worldwide — local shipping takes 2–5 business days. International varies by destination. Returns accepted within 7 days of receipt. See full policy page for details.</p>
            </div>
            <div class="tab-pane fade" id="rev" role="tabpanel">
              <div class="text-white-50 small">
                {% if product.reviews.all %}
                  {% for review in product.reviews.all %}
                    <strong>{{ review.user.username }}</strong> — "{{ review.comment }}"<br/>
                  {% endfor %}
                {% else %}
                  <p>No reviews yet. Be the first to review this product!</p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="mt-5 related" data-aos="fade-up">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 class="h4">You might also like</h3>
        <a href="{% url 'shop' %}" class="text-white-50">View all products</a>
      </div>
      <div class="row g-3">
        {% for related in related_products %}
          <div class="col-6 col-md-3 {% if forloop.counter > 2 %}d-none d-md-block{% endif %}">
            <div class="product-card p-2 text-center">
              {% if related.images.first %}
                <img src="{{ related.images.first.image.url }}" class="w-100 rounded mb-2" style="height: 160px; object-fit: cover" alt="{{ related.name }}">
              {% else %}
                <img src="" class="w-100 rounded mb-2" style="height: 160px; object-fit: cover" alt="{{ related.name }} - No image available">
              {% endif %}
              <div class="small text-white-50">{{ related.name }}</div>
              <div class="fw-bold">₦{{ related.price }}</div>
              <a href="{% url 'product_detail' related.id %}" class="btn btn-sm btn-ghost mt-2">View</a>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </main>

  <footer class="section pt-5 pb-4">
    <div class="container">
      <div class="row g-4">
        <div class="col-md-4">
          <div class="footer-brand h4">SOFT BOY <span class="text-white-50">CROWN</span></div>
          <p class="text-white-50 small">Timeless street with soft energy. Lagos-born, globally worn.</p>
          <div class="d-flex gap-3 mt-2">
            <a href="https://www.instagram.com/soft_boycrown7?igsh=MWgzaGVudXJnajBnNQ==" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
            <a href="https://vm.tiktok.com/ZSHWjUvFVPTYy-C0RBu/" aria-label="TikTok"><i class="bi bi-tiktok"></i></a>
          </div>
        </div>
        <div class="col-md-2">
          <div class="eyebrow mb-2">Quick Links</div>
          <ul class="list-unstyled text-white-50 small m-0">
            <li><a href="{% url 'shop' %}">Shop</a></li>
            <li><a href="{% url 'lookbook' %}">Lookbook</a></li>
            <li><a href="{% url 'our_story' %}">About</a></li>
            <li><a href="{% url 'contact' %}">Contact</a></li>
          </ul>
        </div>
        <div class="col-md-3">
          <div class="eyebrow mb-2">Help</div>
          <ul class="list-unstyled text-white-50 small m-0">
            <li><a href="#">Returns & Exchange</a></li>
          </ul>
        </div>
        <div class="col-md-3">
          <div class="eyebrow mb-2">Legal</div>
          <ul class="list-unstyled text-white-50 small m-0">
            <li><a href="#">Terms & Conditions</a></li>
            <li><a href="#">Privacy Policy</a></li>
          </ul>
        </div>
      </div>
      <div class="text-white-50 small mt-4">© <span id="y"></span> Soft Boy Crown. All rights reserved.</div>
    </div>
  </footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
  // Initialize AOS
  AOS.init({ once: true, duration: 700, easing: 'ease-out-cubic' });

  // Update footer year
  document.getElementById('y').textContent = new Date().getFullYear();

  // Function to get CSRF token from cookie
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  // Function to show toast notification
  function showToast(message, type = 'success') {
    const toastContainer = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast align-items-center text-bg-dark toast-${type} mb-2`;
    toast.setAttribute('role', 'alert');
    toast.setAttribute('aria-live', 'assertive');
    toast.setAttribute('aria-atomic', 'true');
    toast.innerHTML = `
      <div class="d-flex">
        <div class="toast-body">${message}</div>
        <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    `;
    toastContainer.appendChild(toast);
    const bsToast = new bootstrap.Toast(toast);
    bsToast.show();
    setTimeout(() => bsToast.hide(), 5000);
  }

  // Thumbnail gallery
  const thumbs = document.querySelectorAll('#thumbList img');
  const main = document.getElementById('mainImage');
  thumbs.forEach(t => {
    t.addEventListener('click', () => {
      thumbs.forEach(x => x.classList.remove('active'));
      t.classList.add('active');
      main.src = t.dataset.full || t.src;
      main.alt = t.alt;
    });
  });

  // Color swatches
  document.querySelectorAll('#colorSwatches .swatch').forEach(s => {
    s.addEventListener('click', () => {
      document.querySelectorAll('#colorSwatches .swatch').forEach(x => x.classList.remove('selected'));
      s.classList.add('selected');
      document.getElementById('selected-color').value = s.dataset.color || '';
      const color = s.dataset.color;
      const match = Array.from(thumbs).find(img => img.dataset.full && img.dataset.full.includes(color));
      if (match) { match.click(); }
    });
  });

  // Size selection
  document.querySelectorAll('.size-btn').forEach(b => {
    b.addEventListener('click', () => {
      document.querySelectorAll('.size-btn').forEach(x => x.classList.remove('selected'));
      b.classList.add('selected');
      document.getElementById('selected-size').value = b.dataset.size || '';
    });
  });

  // Quantity controls
  const qtyInput = document.getElementById('qty');
  document.getElementById('incQty').addEventListener('click', () => {
    qtyInput.value = Number(qtyInput.value) + 1;
  });
  document.getElementById('decQty').addEventListener('click', () => {
    if (Number(qtyInput.value) > 1) qtyInput.value = Number(qtyInput.value) - 1;
  });

  // Add to cart
  document.getElementById('addToCartForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);
    const addToCartBtn = document.getElementById('addToCart');
    
    // Disable button to prevent multiple submissions
    addToCartBtn.disabled = true;
    
    try {
      const response = await fetch(form.action, {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
          'X-Requested-With': 'XMLHttpRequest', // Ensure view detects AJAX
        },
        body: formData,
      });
      
      const data = await response.json();
      
      if (response.ok && data.status === 'success') {
        // Success: Show success message and update cart count
        showToast(data.message, 'success');
        const count = document.querySelector('.cart-count');
        if (count && data.cart_count !== undefined) {
          count.textContent = Math.min(999, data.cart_count);
        }
      } else {
        // Error: Show error message
        showToast(data.message || 'An error occurred while adding to cart.', 'error');
      }
    } catch (error) {
      showToast('Failed to add to cart. Please try again.', 'error');
      console.error('Error:', error);
    } finally {
      // Re-enable button
      addToCartBtn.disabled = false;
    }
  });

  // Keyboard gallery navigation
  document.addEventListener('keydown', (e) => {
    const activeIndex = Array.from(thumbs).findIndex(img => img.classList.contains('active'));
    if (e.key === 'ArrowLeft') {
      thumbs[(activeIndex - 1 + thumbs.length) % thumbs.length].click();
    } else if (e.key === 'ArrowRight') {
      thumbs[(activeIndex + 1) % thumbs.length].click();
    }
  });
</script>
</body>
</html>